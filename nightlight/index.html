<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/core.css">
    <title>Nightlight</title>

    <style>
      canvas {
        display: block;
      }

      img {
        image-rendering: pixelated;
      }

      /* contains all the canvas elements and the starting menu */
      #container {
        /* makes positioning things inside here easier */
        position: relative;
        width: 480px;
        height: 360px;
      }

      /* LOADING SCREEN STUFF */

      #menu-container {
        width: 100%;
        height: 100%;
      }

      /* centered menu */
      .menu {
        text-align: center;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
      }

      /* image in the background */
      #menu-background {
        position: absolute;
        z-index: -1;
        filter: brightness(50%);
      }

      /* opacity increases once the game can be played */
      @keyframes background-opacity-increase {
        from {
          filter: brightness(50%);
        }

        to {
          filter: brightness(100%);
        }
      }

      #menu-background.active {
        animation-duration: 1s;
        animation-name: background-opacity-increase;
        filter: brightness(100%);
      }

      #menu-screen {
        display: none;
      }

      /* we make our own fake progress bar element */
      .progress-bar {
        box-sizing: border-box;
        border: 1px solid black;
      }
      .progress-bar-inside {
        background-color: #7baaf7;
        height: 100%;
        width: 0;
      }
      #loading-screen-progress-bar {
        height: 12px;
        width: 480px;
        position: absolute;
        bottom: 0;
      }
      #level-editor-ui {
        display: none;
      }
      #main {
        display: flex; /* as in the tape */
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: space-between;
      }
    </style>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-77118590-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-77118590-7');
    </script>
  </head>

  <body>
    <h1>Nightlight</h1>

    <p><a href="https://scratch.mit.edu/projects/150752251/">Play the original</a> by <a href="https://scratch.mit.edu/users/TriforceMayhem/">TriforceMayhem</a>. Assets are used with permission.</p>

    <table>
      <tr>
        <td id="container">
          <div id="menu-container">
            <div id="menu-background"><img src="assets/thumb.png" width="100%"></div>
            <div id="loading-screen" class="menu">
              <img src="assets/loading.png">
            </div>
            <div id="menu-screen" class="menu">
              <div><button id="play-button">Start Game</button></div>
              <div><button id="load-code-button">Load Level Code</button></div>
            </div>
            <div id="loading-screen-progress-bar" class="progress-bar">
              <div class="progress-bar-inside" id="progress-bar"></div>
            </div>
          </div>
        </td>

        <td id="level-editor-ui">
          <div>
            <b>
              This is very experimental and very broken.
              Use Up/Down to change blocks.
              Left mouse to place, right mouse to remove.
              There are many problems.
            </b>
          </div>

          <hr>

          <div><b>Active block:</b></div>
          <div><img id="level-editor-active-block-image" width="96px"></div>
          (letter <span id="level-editor-active-block-char">A</span>)

          <hr>

          <div>
            <button id="level-editor-get-code">Get Level Code</button>
            <div><textarea id="level-editor-code-output"></textarea></div>
          </div>
        </td>
      </tr>
    </table>

    <div><label>Volume: <input type="range" min="0" max="100" id="volume"></label><span id="volume-level"></span></div>

    <div id="cb">
      <button onclick="runtime.level++;runtime.renderLevel();">Next level</button>
      <button onclick="runtime.level--;runtime.renderLevel();">Prev level</button>
    </div>
    <script>document.getElementById("cb").style.display=location.hash==="#cheaty-boi"?"block":"none"</script>

    <pre>
      <b>Changelog:</b>
      v0.1.9:
       * Made boss collision testing around 60% faster
       * And a secret new feature...

      v0.1.8:
       * Around 50% performance gain (in average frame time on the first level)
       * Optimized star rendering (again, but its actually really fast this time)
       * Optimized grass rendering (made it static)
       * Optimized corner rendering (made it static)
       * Optimized rendering as a whole
       * Sword rotates around the correct point

      v0.1.7:
       * Average frame times seem to be around 15% lower than before
       * Star rendering greatly optimized.
         You'd be surprised how long they took to render. Seriously.
       * Rewrote large portions of collision testing to not be slow as hell.
         There could be problems, please tell me.
       * Sprites are only sorted if they have to be sorted.
       * Crumbling blocks reset instantly on death
       * Jump lights reset instantly on death
       * Removed shortcut to get to the end using a link
       * Other potential optimizations

      v0.1.6:
       * Sword boss: fixed animation length
       * Bridge level: blocks fall instantly so you have to actually use the dots
       * Implemented pause (Escape)
       * Implemented level codes
       * Changed loading screen

      v0.1.5:
       * Last boss: player spawns in random locations to fix "hold up to win"
       * Last boss: correct background image and stars
       * Last boss: other behavior corrections
       * Ending: images alligned correctly
       * Sword boss: behavior corrections

      v0.1.4:
       * Death resets levels (to some degree)
       * Other bug fixes

      v0.1.3:
       * Ending

      v0.1.2:
       * Improved loading screen
       * Basic start menu
       * Text in levels
       * Fixed hit sound timing in sword boss

      v0.1.0.1:
       * Make Reilly triggered.

      v0.1:
       * fixed being able to do up to 3 hits in one cycle on the second boss
       * really, I just want to be done with this.

      v0.0.999.2:
       * Volume slider won't crash the game and doesn't start out on 0.5%.
       * Even Reilly should be able to beat the second boss now.
        * YOU HAVE AN ENTIRE FIVE SECONDS TO HIT THE THING NOW I THINK YOU CAN DO IT
       * Fixed some delays during the second boss.

      v0.0.999.1:
       * Added just about all sounds
       * Boss paterns are just about perfect

      v0.0.999.0:
       * Added the last boss

      v0.0.9.5:
       * Things that are scaled will still look pixelated
       * Added debug tools
       * Volume slider that starts at 50%

      v0.0.9.4: The Optimization Update
       * Rendering optimized
        * Performance gains of nearly 2x in some cases
        * The hardest level to render (the first one with a button) now runs at 60 fps on a chromebook
       * Collision optimized
        * Death pieces can now in some cases have almost no performance impact
       * Fixed some bugs from the previous version

      v0.0.9.3:
       * Noss bullets don't render rotated
       * 100 background stars instead of 50
       * Light block toggle switches now show up again when you hit another one
       * You now won't ever float when skipping around levels
       * Stop button stops audio
       * Other bug fixes

      v0.0.9.2:
       * Second boss's bullets actually glide to the center
       * Second boss has hit effects
       * Hit effects improved
       * Pressing stop stops audio
       * Boss coins are centered properly
       * Other minor garbage

      v0.0.9.1:
       * Second boss nearly done

      v0.0.9:
       * Sword boss runs almost perfectly on a chromebook
       * Sword boss becomes vulnerable at the right time
       * Second boss very early implementation

      Pre v0.0.9:
       * no one knows
    </pre>
    <script src="dist/bundle.js"></script>
  </body>
</html>
