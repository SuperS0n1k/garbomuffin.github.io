<!DOCTYPE html>
<html>
  <head>
    <title>What Transaction Fee Should I Use?</title>
    <style>
      body {
        text-align: center;
        font-size: 18px;
      }
      .big {
        font-size: 10vw;
      }
      input {
        border: 0;
        padding: 0;
        font: inherit;
        font-weight: bold;
        width: 50px; /* basic styling for non js */
      }
      input:focus {
        outline: none;
      }

      /* https://www.thatstevensguy.com/programming/disable-arrows-on-number-inputs/ */
      input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      
      input[type="number"] {
        -moz-appearance: textfield;
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body>
    <p>What transaction fee should I pay?</p>

    <h1 class="big">1 SAT/BYTE</h1>

    <p>(0.01 mBTC/KB or 0.00001 BTC/KB)</p>

    <p>For a transaction of size <input id="tx-size" value="226" placeholder="226" type="number" min="0">bytes that results in a fee of <b><span id="tx-fee">0.00000226</span> BTC</b>.</p>

    <p>At a price of 1 BTC = ~$<input id="usd-per-btc" value="4000" placeholder="4000" type="number" min="0">that's equivalent to <b>~<span id="cost-per-tx">0.90</span> cents</b>.</p>

    <noscript><p>Enable javascript for some more things. (no tracking, no ads, no bullshit)</p></noscript>

    <a href="why.html">Why?</a>

    <script>
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");

      for (var el of document.getElementsByTagName("input")){
        adjustSize(el);

        el.resize = function(){
          adjustSize(this);
        }

        function update(){
          updatePrice(
            Number(valueOf(document.getElementById("tx-size"))),
            Number(valueOf(document.getElementById("usd-per-btc")))
          );
          adjustSize(this);
        }

        el.onchange = update;
        el.onkeypress = update;
        el.onkeydown = update;
        el.onkeyup = update;
      }

      function adjustSize(el){
        var fontSize = window.getComputedStyle(el, null).getPropertyValue("font-size");
        var fontFamily = window.getComputedStyle(el, null).getPropertyValue("font-family");

        ctx.font = fontSize + " " + fontFamily;

        var size;
        if (el.value.trim() === ""){
          size = Math.round(ctx.measureText(el.getAttribute("placeholder")).width);
        }else{
          size = Math.round(ctx.measureText(el.value).width);
        }
        size += 4;

        el.style.width = size + "px";
      }

      function updatePrice(size, price){
        var size = Number(document.getElementById("tx-size").value) / 100000000;
        var cost = price * size * 100;

        var fixedCost = cost.toFixed(2);
        var fixedSize = size.toFixed(8);

        document.getElementById("usd-per-btc").value = price;
        document.getElementById("usd-per-btc").resize();
        document.getElementById("cost-per-tx").textContent = fixedCost;
        document.getElementById("tx-fee").textContent = fixedSize;
      }

      function valueOf(el){
        if (el.value.trim() === ""){
          return el.getAttribute("placeholder");
        }else{
          return el.value;
        }
      }

      fetch("https://api.coinmarketcap.com/v1/ticker/bitcoin/", {
        referrer: "no-referrer",
        cache: "no-store",
      }).then(res => res.json())
        .then(res => {
          var price = Number(res[0].price_usd);

          updatePrice(
            Number(valueOf(document.getElementById("tx-size"))),
            price
          );
        });
    </script>
  </body>
</html>
